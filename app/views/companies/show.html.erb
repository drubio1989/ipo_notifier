<div class="chat-page">
  <h1 class="conversation-title">
    Try asking the following:
  </h1>
  <ul class="list-disc list-inside max-w-2xl mx-auto text-center space-y-3 text-gray-500 font-mono">
    <li>1. Can you provide a summary of the key details from [Company Name]’s latest S-1 filing?</li>
    <li>2. What are the most common risk factors disclosed in recent S-1 filings?</li>
    <li>3. What valuation or share price range does [Company Name] indicate in its S-1 filing?</li>
    <li>4. How does [Company Name] plan to use the proceeds from its IPO as outlined in the S-1?</li>
  </ul>
  <br>
  <div id="conversation-data" data-conversation-id="<%= @conversation.id %>"></div>
  <!-- CHAT BOX -->
  <div id="chat-box"
       class="chat-box space-y-4 max-w-2xl mx-auto bg-white p-4 rounded-lg shadow-md overflow-y-auto"
       role="log" aria-live="polite" aria-relevant="additions">
    <% if @conversation.messages.any? %>
      <% @conversation.messages.order(:created_at).each do |msg| %>
        <div class="message <%= "role-#{msg.role.to_s.parameterize}" if msg.role.present? %>" data-role="<%= msg.role %>">
          <div class="message-meta">
            <span class="message-role font-semibold"><%= msg.role&.capitalize || "Unknown" %>:</span>
            <time class="message-time text-xs text-gray-400"><%= msg.created_at.strftime("%b %-d, %Y %H:%M") %></time>
          </div>
          <div class="message-content text-gray-800 mt-1">
            <%= sanitize(msg.content, tags: %w(p br strong em a code pre), attributes: %w(href target rel)) %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="no-messages text-gray-400 text-center">No messages yet — start the conversation below.</div>
    <% end %>
  </div>
  <!-- FORM -->
  <%= form_with model: @message,
      url: company_conversation_path(@company.id, @conversation.id),
      local: false,
      html: { class: "chat-form max-w-2xl mx-auto mt-4" } do |f| %>
    <div class="flex flex-col space-y-3">
      <%= f.text_area :content,
          rows: 3,
          placeholder: "Type your message...",
          class: "rounded-md border border-gray-300 bg-gray-100 text-gray-800 py-2 px-3 w-full resize-none focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent",
          aria: { label: "Message text" } %>
      <%= f.submit "Send",
          class: "bg-teal-500 hover:bg-teal-700 text-sm font-semibold text-white py-2 px-4 rounded transition-colors duration-200 self-end" %>
    </div>
  <% end %>
</div>
<!-- HIDDEN FIELD FOR CABLE IDENTIFICATION -->
<%= tag.div nil,
    id: "conversation-data",
    data: { conversation_id: @conversation.id } %>
